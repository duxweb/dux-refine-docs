import{a as S,b as U,c as V}from"./chunk-OBAR2ZRN.js";import{C as H,D as M,a as ot,j as A,k as B,m as T,n as h,o as f,p as L,r as C,s as k,v as F,z as D}from"./chunk-XRLDNMSZ.js";var tt=ot((Gt,bt)=>{bt.exports={name:"islandjs",version:"0.7.31",description:"Vite & Islands architecture SSG framework",packageManager:"pnpm@7.9.2",type:"module",main:"dist/node/index.cjs",module:"dist/node/index.js",types:"dist/node/index.d.ts",bin:{island:"./bin/island.js"},exports:{".":{types:"./dist/index.d.ts",import:"./dist/node/index.js",require:"./dist/node/index.cjs"},"./dist/*":"./dist/*","./package.json":"./package.json","./theme":{types:"./theme.d.ts",default:"./src/theme-default/index.ts"},"./runtime":{type:"./runtime.d.ts",default:"./src/runtime/index.ts"}},scripts:{"pnpm-install":"pnpm install",dev:"tsup --watch --format=cjs,esm",build:"cross-env NODE_ENV=production tsup --format=cjs,esm && tsx scripts/pre-bundle.cts",prepublishOnly:"pnpm build",changelog:"conventional-changelog -p angular -i CHANGELOG.md -s",inspect:"serve .vite-inspect"},keywords:["vite","ssg","island architecture","docs","framework"],author:"Sanyuan0704",license:"MIT",dependencies:{"@babel/core":"7.18.6","@babel/helper-plugin-utils":"7.18.6","@iconify-json/carbon":"1.1.8","@islandjs/plugin-backtop":"0.7.31","@islandjs/plugin-search":"0.7.31","@mdx-js/mdx":"2.1.3","@mdx-js/react":"2.1.3","@mdx-js/rollup":"2","@svgr/core":"6.3.1","@unocss/preset-attributify":"0.45.26","@unocss/preset-icons":"0.45.29","@unocss/preset-wind":"0.45.26","@unocss/vite":"0.45.26","@vitejs/plugin-react":"2.0.1",acorn:"8.8.0","body-scroll-lock":"4.0.0-beta.0",cac:"6.7.12",compression:"1.7.4","copy-to-clipboard":"3.3.2",debug:"4.3.4",esbuild:"0.15.5","fast-glob":"3.2.11","fs-extra":"10.1.0","github-slugger":"1.4.0",hast:"1.0.0","hast-util-from-html":"1.0.0",husky:"8.0.1","lodash-es":"4.17.21","mdast-util-mdxjs-esm":"1.3.0","medium-zoom":"1.0.6",nprogress:"^0.2.0",ora:"6.1.2",picocolors:"1.0.0",polka:"0.5.2",react:"18.2.0","react-dom":"18.2.0","react-helmet-async":"1.3.0","react-router-dom":"6.3.0","rehype-autolink-headings":"6.1.1","rehype-external-links":"2.0.1","rehype-highlight":"5.0.2","rehype-slug":"5.0.1","remark-directive":"2.0.1","remark-frontmatter":"4.0.1","remark-gemoji":"7.0.1","remark-gfm":"3.0.1","remark-mdx-frontmatter":"2.0.3",sass:"1.54.5",shiki:"0.11.1","simple-git":"3.14.1",sirv:"2.0.2",unified:"10.1.2","unist-util-visit":"4.1.1","unist-util-visit-children":"2.0.0",unocss:"0.45.26",vite:"~3.1.4","vite-plugin-inspect":"0.7.4"},devDependencies:{"@babel/preset-react":"7.18.6","@babel/traverse":"^7.19.0","@types/babel__core":"^7.1.19","@types/babel__helper-plugin-utils":"^7.10.0","@types/babel__traverse":"^7.18.1","@types/compression":"^1.7.2","@types/debug":"^4.1.7","@types/fs-extra":"^9.0.13","@types/github-slugger":"^1.3.0","@types/hast":"^2.3.4","@types/koa":"^2.13.5","@types/koa-router":"^7.4.4","@types/lodash-es":"^4.17.6","@types/nprogress":"^0.2.0","@types/polka":"^0.5.4","@types/react":"^18.0.17","@types/react-dom":"^18.0.6","@types/resolve":"^1.20.2","es-module-lexer":"^1.0.3",resolve:"^1.22.1",typescript:"4.7.4"},files:["bin","src/runtime","src/theme-default","dist","vendors","template.html","src/shared/constants","src/shared/utils","src/shared/types","runtime.d.ts","theme.d.ts"],"lint-staged":{"**/*.{js,jsx,tsx,ts,json}":["eslint --fix"]}}});import{resolve as E}from"path";import{cac as vt}from"cac";import{build as nt}from"vite";import rt,{join as l,dirname as at}from"path";import v,{copy as N,pathExists as lt,remove as ct}from"fs-extra";import pt from"ora";import dt from"debug";import{performance as z}from"perf_hooks";import mt from"picocolors";import{pathToFileURL as ut}from"url";var ht=dt("island:build"),I="island:inject",J="\x1B[32m\u2713\x1B[0m",ft="\x1B[31m\u2716\x1B[0m",P=class{#s;#t;#i;#n;#r;#e;#a=new Map;constructor(e,t){this.#t=e,this.#s=this.#t.root,this.#i=t,this.#t.outDir?this.#e=rt.isAbsolute(this.#t.outDir)?this.#t.outDir:l(this.#s,f,this.#t.outDir):this.#e=l(this.#s,f,"dist")}async build(){let e=pt();e.start("Building client + server bundles...");try{let[t,s]=await Promise.all([this.#c(),this.#p()]);e.stopAndPersist({symbol:J}),this.#n=t,this.#r=s,await N(l(h,"ssr","assets"),l(this.#e,"assets")),await v.writeFile(l(h,"package.json"),JSON.stringify({type:"module"}));let i=l(this.#s,T);await lt(i)&&await N(i,this.#e);let c=l(L),{render:m,routes:o}=await S(ut(c));return[m,o]}catch(t){throw e.stopAndPersist({symbol:ft}),t}}async renderPages(e,t){let s=this.#n.output.find(p=>p.type==="chunk"&&p.isEntry),i=await v.readFile(l(this.#e,s.fileName),"utf-8"),c=this.#r.output.filter(p=>p.type==="asset"&&p.fileName.endsWith(".css")),{default:m}=await S("ora"),o=m();o.start("Rendering page in server side...");let u={code:i,fileName:s.fileName};await Promise.all(t.map(p=>this.#l(e,p.path,u,c))),await this.#d(e,u,c);try{await v.copy(F,this.#e)}catch(p){throw console.log(p),p}o.stopAndPersist({symbol:J})}async end(){process.env.DEBUG||await ct(l(h))}async islandsBuild(e){return this.#o(!1,{build:{minify:!process.env.NO_MINIFY,outDir:l(h),ssrManifest:!1,rollupOptions:{external:k,input:I}},plugins:[{name:"island-inject",enforce:"post",resolveId(t){if(t.includes(C)){let[s,i]=t.split(C);return this.resolve(s,i,{skipSelf:!0})}if(t===I)return I},load(t){if(t===I)return e},generateBundle(t,s){for(let i in s)s[i].type==="asset"&&delete s[i]}}]})}async#c(){return this.#o(!1,{},"client")}async#p(){return this.#o(!0,{},"ssr")}async#l(e,t,s,i){let c={context:{}},{appHtml:m,propsData:o,islandToPathMap:u,pageData:p}=await e(t,c.context,this.#t.enableSpa),x=Object.keys(u).length>0,y="";if(x&&!this.#t.enableSpa){let n=U(JSON.stringify(u)),d=this.#a.get(n);if(!d){let O=this.#m(u);d=(async()=>{let b=await this.islandsBuild(O);try{await N(l(h,"assets"),l(this.#e,"assets"))}catch{}return b.output[0].fileName})(),this.#a.set(n,d)}y=await d}let{helmet:a}=c.context,g=this.#t.siteData?.head?.map(n=>{let[d,O,b]=n,$=Object.keys(O).reduce((it,_)=>`${it} ${_}="${O[_]}"`,"");return b==null?`<${d} ${$} />`:`<${d} ${$}>${b}</${d}>`}).join(`
`),et=n=>n.replace(/\//g,"_")+".js",j=n=>M(n,this.#t.base||"/"),st=`
  <!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="icon" href="${this.#t.siteData.icon}" type="image/svg+xml"></link>
      ${g||""}
      ${a?.title?.toString()||""}
      ${a?.meta?.toString()||""}
      ${a?.link?.toString()||""}
      ${a?.style?.toString()||""}
      <script defer src='https://ga.jspm.io/npm:es-module-shims@1.6.0/dist/es-module-shims.js'></script>
      <script type="importmap">
        {
          "imports": {
            ${k.map(n=>`"${n}": "${j(et(n))}"`).join(",")}
          }
        }
      </script>

      ${i.map(n=>`<link rel="stylesheet" href="${j(n.fileName)}">`).join(`
`)}

    </head>
    <body>
      <div id="root">${m}</div>
      ${this.#t.enableSpa?`<script>window.ISLAND_PAGE_DATA=${JSON.stringify(p)};</script>`:""}
      ${!this.#t.enableSpa&&x?`<script id="island-props">${JSON.stringify(o)}</script><script type="module" src="${j(y)}"></script>`:""}
      ${this.#t.enableSpa?`<script type="module" src="${j(s.fileName)}"></script>`:`<script type="module">${s.code}</script>`}
    </body>
  </html>`.trim(),R=(n=>{let d=H(this.#t.base||"/");return n.endsWith("/")?`${n}index.html`.replace(d,""):`${n}.html`.replace(d,"")})(t);await v.ensureDir(l(this.#e,at(R))),await v.writeFile(l(this.#e,R),st)}#d(e,t,s){return this.#l(e,"/404",t,s)}#m(e){return`
      ${Object.entries(e).map(([t,s])=>`import { ${t} } from '${s}';`).join("")}
      window.ISLANDS = {
        ${Object.entries(e).map(([t])=>`${t}`).join(",")}
      };
      window.ISLAND_PROPS = JSON.parse(
        document.getElementById('island-props').textContent
      );
    `}async#o(e,t={},s){let i=async o=>({...t,mode:"production",define:{NODE_ENV:process.env.NODE_ENV||JSON.stringify("production")},root:this.#s,optimizeDeps:{force:this.#i?.force},plugins:[await V(this.#t,o),...t?.plugins||[]],ssr:{},build:{minify:!process.env.NO_MINIFY&&!o,ssr:o,outDir:o?l(h,"ssr"):this.#e??l(this.#s,f),cssCodeSplit:!1,ssrManifest:!o,emptyOutDir:!0,rollupOptions:{output:{entryFileNames:o?"[name].mjs":void 0,format:"es"},input:o?B:A},sourcemap:this.#i?.sourcemap,...t?.build}}),c=z.now(),m=await nt(await i(e));if(s){let o=(z.now()-c).toFixed(2);ht(`${s} build time: ${mt.blue(`${o}ms`)}`)}return m}};async function q(r,e){let t=await D(r,"build","production",e.config),s=new P(t,e),[i,c]=await s.build();await s.renderPages(i,c),await s.end()}import gt from"fs";import W,{join as K}from"path";import yt from"sirv";import X from"compression";import Q from"polka";async function Z(r,e){let t=e.port??4173,s=e.host??"localhost",i=await D(r,"serve","production"),c=i.base?.replace(/^\//,"").replace(/\/$/,"")||"",m=a=>!a.includes("/assets/"),o="";i.outDir?o=W.isAbsolute(i.outDir)?i.outDir:K(i.root,f,i.outDir):o=K(i.root,f,"dist");let u=gt.readFileSync(W.resolve(o,"./404.html")),p=(a,g)=>{g.statusCode=404,m(a.path)&&g.end(u)},x=X(),y=yt(o,{etag:!0,maxAge:31536e3,immutable:!0,setHeaders(a,g){m(g)&&a.setHeader("cache-control","no-cache")}});c?Q({onNoMatch:p}).use(c,y,X).listen(t,s,a=>{if(a)throw a;console.log(`Built site served at http://${s}:${t}/${c}/
`)}):Q({onNoMatch:p}).use(x,y).listen(t,s,a=>{if(a)throw a;console.log(`Built site served at http://${s}:${t}/
`)})}var wt=tt(),w=vt("island").version(wt).help();w.option("--config [config]","[string]explicitly specify a config file to use with the --config CLI option");w.command("[root]","start dev server").alias("dev").option("--host <host>","[string] specify hostname").option("-p, --port <port>","[number] specify port").option("--cacheDir [cacheDir]","[string] set the directory of cache").option("--force [force]","[boolean] force the optimizer to ignore the cache and re-bundle").option("-m, --mode <mode>","[string] set env mode").option("-l, --logLevel <level>","[string] info | warn | error | silent").option("--clearScreen","[boolean] allow/disable clear screen when logging").option("--https","[boolean] use TLS + HTTP/2").option("--cors","[boolean] enable CORS").option("--strictPort","[boolean] exit if specified port is already in use").option("--open [path]","[boolean | string] open browser on startup").action(async(r,e)=>{try{r=E(r);let t=async()=>{let{createDevServer:s}=await import(`./dev.js?t=${Date.now()}`),i=await s(r,e,async()=>{await i.close(),await t()});await i.listen(),i.printUrls()};await t()}catch(t){console.log(t),process.exit(1)}});w.command("build [root]","build for production").option("--force [force]","[boolean] force the optimizer to ignore the cache and re-bundle").option("--sourcemap","[boolean] output source maps for build (default: false)").action(async(r,e)=>{try{r=E(r),await q(r,e)}catch(t){console.log(t)}});w.command("start [root]","serve for production").option("--port <port>","port to use for serve").option("--host <host>","[string] specify hostname").action(async(r,e)=>{try{r=E(r),await Z(r,e)}catch(t){console.log(t)}});w.parse();
//# sourceMappingURL=cli.js.map