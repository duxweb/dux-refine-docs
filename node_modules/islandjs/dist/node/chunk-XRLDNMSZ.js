var it=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);import{join as s}from"path";import{fileURLToPath as j}from"url";var pt=()=>process.env.NODE_ENV==="production",lt=/(c|m)?tsx?$/,ut=/\.mdx?$/,a=s(j(import.meta.url),"../../.."),x=s(a,"src/runtime"),ft=s(a,"src/shared"),mt=s(x,"index.ts"),dt=s(x,"client-entry.tsx"),gt=s(x,"ssr-entry.tsx"),A=s(a,"src/theme-default"),ht="public",S=s(a,"node_modules",".island"),Et=s(".island"),M="ssr-entry.mjs",Tt=s(S,"ssr",M),Rt=s(S,"routes.tsx"),xt=s(a,"template.html"),Pt="!!ISLAND!!",_t=["react","react-dom","react-dom/client","react/jsx-runtime"],F=s(a,"dist","node"),P=s(a,"dist","runtime"),Dt=P,Ct=s(F,"cli.js"),Ut=s(a,"vendors"),At=["tip","warning","danger","info"],St="virtual:custom-styles",Lt="virtual:ui-components";import k from"fs-extra";import N from"path";import B from"picocolors";var L="island-theme-appearance",wt=["https://island-tutorial.sanyuan0704.top","https://island.sanyuan0704.top","https://islandjs.dev"],v=/^(https?:)?\/\//;import{loadConfigFromFile as G}from"vite";var{pathExistsSync:_}=k,d=(t,...e)=>N.resolve(t,".island",...e),X=t=>{if(t){let[e]=t.split(".");return e}else return"config"},z=(t,e)=>{try{let o=["js","ts"],r=X(e),i=o.map(n=>d(t,`${r}.${n}`)).find(_);if(r!=="config"&&!_(i)){let n=d(t,`${e}`);throw new Error(`failed to load config from ${n}`)}return i}catch(o){throw console.log(B.red("failed to load config file")),o}};async function W(t,e,o,r){let i=z(t,r),n=await G({command:e,mode:o},i,t);if(n){let{config:p={},dependencies:T=[],path:m}=n,R=await(typeof p=="function"?p():p);return[m,R,T]}else return[i,{},[]]}function V(t){let e=t?.head??[];return(t?.appearance??!0)&&e.push(["script",{id:"check-dark-light"},`
        ;(() => {
          const saved = localStorage.getItem('${L}')
          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {
            document.documentElement.classList.add('dark')
          }
        })()
      `]),e}function Y(t,e){return{lang:t.lang||"en-US",title:t.title||"Island",description:t.description||"Island",themeConfig:t.themeConfig||{},head:V(t),base:t.base||"",icon:t.icon||"",root:e,appearance:t.appearance??!0}}async function Ft(t,e,o,r){let[i,n,p]=await W(t,e,o,r),T=N.resolve(t,n.srcDir||""),m=d(t,"theme"),R=_(m)?m:A,{pluginSearch:b}=await import(`@islandjs/plugin-search/dist/index.js?t=${Date.now()}`),{pluginBackTop:O}=await import(`@islandjs/plugin-backtop/dist/index.js?t=${Date.now()}`),H=[b(),O()];return{root:t,srcDir:T,outDir:n.outDir,themeDir:R,configPath:i,configDeps:p,base:n.base||"",tempDir:d(t,"node_modules",".island"),vite:{...n.vite,base:n.base??"/"},allowDeadLinks:n.allowDeadLinks??!1,siteData:Y(n,t),enableSpa:n.enableSpa??!0,route:n.route??{},markdown:n.markdown??{},plugins:H.concat(n.plugins||[])}}function kt(t){return t}import{normalizePath as y}from"vite";import tt from"fast-glob";import et from"fs-extra";import f from"path";import D from"path";import{normalizePath as K}from"vite";var w=["**/node_modules/**","**/.*","**/dist/**"],g="virtual:routes",I=["js","jsx","ts","tsx","md","mdx"],c,C;function Vt(t={}){let{root:e="src"}=t,o;return{name:"island:vite-plugin-routes",async configResolved(){o=D.isAbsolute(e)?D.join(e):D.join(process.cwd(),e),c=new E(K(o),t),await c.init(),C=new RegExp(`\\.(${c.getExtensions().join("|")})$`)},resolveId(r){if(r===g)return"\0"+g},load(r,i){if(r==="\0"+g)return{code:c.generateRoutesCode(i?.ssr),moduleSideEffects:!1}},configureServer(r){let i=()=>{let n=r.moduleGraph.getModuleById(`\0${g}`);n&&(r.moduleGraph.invalidateModule(n),r.ws.send({type:"full-reload"}))};r.watcher.add(o).on("add",async n=>{n.startsWith(o)&&C.test(n)&&(await c.addRoute(n),i())}).on("unlink",async n=>{n.startsWith(o)&&C.test(n)&&(await c.removeRoute(n),i())})}}}var q=/\?.*$/s,J=/#.*$/s,Qt=t=>t.replace(J,"").replace(q,"");function $(t){return t.charAt(0)==="/"||t.startsWith("https")?t:"/"+t}function Q(t){return t.charAt(t.length-1)==="/"?t.slice(0,-1):t}function Z(t){return Q($(t))}function U(t,e){if(v.test(t))return t;let o=Z(e),r=$(t);return o?`${o}${r}`:r}var ot=t=>t.startsWith("/")?t:`/${t}`,h=t=>(t=t.replace(/\.(.*)?$/,"").replace(/index$/,""),ot(t)),nt=et.readFileSync(f.join(P,"lazyWithPreload.js"),"utf-8"),E=class{constructor(e,o){this.scanDir=e;this.#e=o.extensions||I,this.#o=o.include||[],this.#n=o.exclude||[],this.#r=o.prefix||""}#t=[];#e=[];#o=[];#n=[];#r="";async init(){tt.sync([`**/*.{${this.#e.join(",")}}`,...this.#o],{cwd:this.scanDir,absolute:!0,ignore:[...w,...this.#n]}).sort().forEach(o=>this.addRoute(o))}static getRoutePathFromFile(e,o,r){let i=f.relative(o,e),n=h(i);return U(n,r)}addRoute(e){let o=y(f.relative(this.scanDir,e)),r=h(o),i=f.join(this.scanDir,o);this.#t.push({routePath:r,basePath:this.scanDir,absolutePath:y(i)})}removeRoute(e){let o=f.relative(this.scanDir,e),r=h(o);this.#t=this.#t.filter(i=>i.routePath!==r)}getRoutes(){return this.#t}isExistRoute(e){return this.#t.find(o=>o.routePath===e)}generateRoutesCode(e){return`
${nt.toString()};
import React from 'react';
${this.#t.map((o,r)=>e?`import * as Route${r} from '${o.absolutePath}';`:`const Route${r} = lazyWithPreload(() => import('${o.absolutePath}'))`).join(`
`)}
export const routes = [
${this.#t.map((o,r)=>{let i=e?`() => Route${r}`:`Route${r}.preload`,n=e?`Route${r}.default`:`Route${r}`;return`{ path: '${U(o.routePath,this.#r)}', element: React.createElement(${n}), filePath: '${o.absolutePath}', preload: ${i} }`}).join(`,
`)}
];
`}getExtensions(){return this.#e}};export{it as a,wt as b,pt as c,lt as d,ut as e,a as f,x as g,ft as h,mt as i,dt as j,gt as k,A as l,ht as m,S as n,Et as o,Tt as p,xt as q,Pt as r,_t as s,Dt as t,Ct as u,Ut as v,At as w,St as x,Lt as y,Ft as z,kt as A,Qt as B,Z as C,U as D,h as E,E as F,c as G,Vt as H};
//# sourceMappingURL=chunk-XRLDNMSZ.js.map